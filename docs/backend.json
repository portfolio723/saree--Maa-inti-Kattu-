{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "User's full name."
        },
        "address": {
          "type": "string",
          "description": "User's physical address."
        },
        "phoneNumber": {
          "type": "string",
          "description": "User's phone number."
        },
        "profileImageUrl": {
          "type": "string",
          "description": "URL of the user's profile image.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "email",
        "name"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents a customer order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "Date the order was placed.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the order."
        },
        "status": {
          "type": "string",
          "description": "Current status of the order (e.g., 'Pending', 'Shipped', 'Delivered')."
        }
      },
      "required": [
        "id",
        "userId",
        "orderDate",
        "totalAmount",
        "status"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product available for purchase.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Description of the product."
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the product image.",
          "format": "uri"
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to Category. (Relationship: Category 1:N Product)"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "price",
        "imageUrl",
        "categoryId"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a category of products.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the category."
        },
        "name": {
          "type": "string",
          "description": "Name of the category."
        },
        "description": {
          "type": "string",
          "description": "Description of the category."
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents an item within an order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order item."
        },
        "orderId": {
          "type": "string",
          "description": "Reference to Order. (Relationship: Order 1:N OrderItem)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N OrderItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product in the order item."
        },
        "price": {
          "type": "number",
          "description": "Price of each product in the order item."
        }
      },
      "required": [
        "id",
        "orderId",
        "productId",
        "quantity",
        "price"
      ]
    },
    "Review": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Review",
      "type": "object",
      "description": "Represents a user review for a product.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the review."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Review)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N Review)"
        },
        "rating": {
          "type": "number",
          "description": "Rating given by the user (e.g., 1-5 stars)."
        },
        "comment": {
          "type": "string",
          "description": "Text comment provided by the user."
        },
        "upvotes": {
          "type": "number",
          "description": "Number of upvotes for the review."
        },
        "downvotes": {
          "type": "number",
          "description": "Number of downvotes for the review."
        }
      },
      "required": [
        "id",
        "userId",
        "productId",
        "rating",
        "comment",
        "upvotes",
        "downvotes"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information.  Accessible only by the user themselves. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores orders associated with a specific user. Accessible only by the user themselves. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "orderId",
              "description": "The unique ID of the order."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}/reviews/{reviewId}",
        "definition": {
          "entityName": "Review",
          "schema": {
            "$ref": "#/backend/entities/Review"
          },
          "description": "Stores reviews for a specific product. The `userId` field allows associating the review with a user for display purposes.  Anyone can read reviews for a product. Only the user who created a review can edit/delete it.",
          "params": [
            {
              "name": "productId",
              "description": "The unique ID of the product."
            },
            {
              "name": "reviewId",
              "description": "The unique ID of the review."
            }
          ]
        }
      },
      {
        "path": "/products",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information. Accessible for reading by everyone. Admin roles required for modification.",
          "params": []
        }
      },
      {
        "path": "/categories",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Stores category information. Accessible for reading by everyone. Admin roles required for modification.",
          "params": []
        }
      },
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information for reading by everyone. Admin roles required for modification.",
          "params": [
            {
              "name": "productId",
              "description": "The unique ID of the product."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the Maa Inti Kattu application's features, focusing on user profiles, product catalog, orders, and reviews. It prioritizes security, scalability, and ease of debugging, adhering to the principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters).\n\n**Authorization Independence:**\n\n*   Path-based ownership is used for user-specific data like profiles and orders, ensuring that access control can be enforced without needing to read parent documents. This makes security rules simpler and allows for atomic operations.\n\n**Structural Segregation:**\n\n*   Homogeneous security postures are maintained by storing data with similar access requirements in separate collections. This prevents mixing public and private data within the same collection, simplifying security rules.\n\n**Access Modeling:**\n\n*   User profiles are stored in `/users/{userId}`, enabling secure access based on the authenticated user's ID.\n*   Orders are stored in `/users/{userId}/orders/{orderId}` using hierarchical paths to represent the `User 1:N Order` relationship. This structure simplifies ownership-based security rules.\n*   Products and categories are stored in top-level collections (`/products` and `/categories`) since they do not require user-specific authorization.  Admin roles would manage these.\n*   Reviews are stored in `/products/{productId}/reviews/{reviewId}` and contain a `userId` field, enabling retrieval of reviews for a specific product and associating them with a user.\n\n**QAPs (Rules are not Filters):**\n\n*   The structure allows secure list operations by ensuring that collections contain documents with uniform security requirements.  For example, listing products does not require filtering based on user roles or permissions, as all products are accessible (though the UI will control the presentation based on authentication).\n\n**Data Clarity and Predictability:**\n\n*   Explicit naming conventions are used for collections and fields (e.g., `userId` for user references, `orderDate` for order timestamps).\n\n\n**Denormalization:** No denormalization is needed since access control can depend solely on `request.auth.uid` or global role collections."
  }
}